{% extends "base.html" %}

{% block title %}Admin Paneli{% endblock %}

{% block content %}
<main class="container mt-5">
    <h2>Haber Ekle</h2>
    <form action="{{ url_for('add_news') }}" method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="title">Başlık</label>
            <input type="text" class="form-control" id="title" name="title" required>
        </div>
        <div class="form-group">
            <label for="description">Açıklama</label>
            <div id="editor-container"></div>
            <input type="hidden" id="description" name="description">
        </div>
        <div class="form-group">
            <label for="image">Görsel</label>
            <input type="file" class="form-control" id="image" name="image" required>
        </div>
        <button type="submit" class="btn btn-primary">Haber Ekle</button>
    </form>

    <br><br><h2>Mevcut Haberler</h2>
    <form method="GET" action="{{ url_for('admin') }}" class="search-form">
        <input type="text" name="search" placeholder="Haberlerde ara..." value="{{ request.args.get('search', '') }}">
        <button type="submit">Ara ve Sırala</button>
    </form><br>
    <table class="table table-striped mt-4">
        <thead>
            <tr>
                <th>ID</th>
                <th>Başlık</th>
                <th>Yayınlanma Tarihi</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            {% for news_item in news_items %}
            <tr>
                <td>{{ news_item.id }}</td>
                <td>{{ news_item.title }}</td>
                <td>{{ news_item.published_date.strftime('%d %B %Y %H:%M') }}</td>
                <td>
                    <div class="btn-group" role="group">
                        <a href="{{ url_for('edit_news', news_id=news_item.id) }}" class="btn btn-secondary btn-sm">Düzenle</a>
                        <form action="{{ url_for('delete_news', news_id=news_item.id) }}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-danger btn-sm">Sil</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</main>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script>
    var quill = new Quill('#editor-container', {
        theme: 'snow'
    });
    var form = document.querySelector('form');
    form.onsubmit = function() {
        var description = document.querySelector('input[name=description]');
        description.value = quill.root.innerHTML;
    };
</script>
{% endblock %}
